// ---- Expanded word bank ----
export const WORD_BANK: Record<string, string[]> = {
  "Gen Z Vibes": [
    "rizz", "slay", "bussin", "delulu", "stan", "simp", "mid", "bestie", "purr",
    "sheesh", "unhinged", "gaslight", "gatekeep", "girlboss", "periodt", "respectfully",
    "situationship", "aesthetic", "vibe", "cringe", "basic", "salty", "shook", "sus",
    "tea", "flex", "clout", "fire", "lowkey", "highkey", "ghosting", "finsta",
    "FOMO", "GOAT", "lit", "savage", "shade", "thirsty", "woke", "yeet", "cap"
  ],
  "Psychedelic Trip": [
    "fractal", "kaleidoscope", "mandala", "chakra", "vibration", "enlightenment", "oneness",
    "transcendence", "portal", "spiral", "infinity", "cosmos", "dimension", "frequency",
    "energy", "aura", "crystal", "prism", "vortex", "nebula", "galaxy", "stardust",
    "moonbeam", "sunburst", "rainbow", "aurora", "mirage", "illusion", "vision", "dreamscape",
    "trance", "meditation", "nirvana", "bliss", "harmony", "unity", "consciousness", "awakening",
    "metamorphosis", "rebirth", "euphoria", "serenity"
  ],
  "Viral Internet": [
    "meme", "viral", "trending", "algorithm", "influencer", "aesthetic", "timeline", "multiverse",
    "speedrun", "cursed", "blessed", "chaotic", "cottagecore", "goblincore", "weirdcore",
    "traumacore", "vaporwave", "hyperpop", "girlhood", "boyhood", "adulting", "NPC",
    "main character", "side quest", "lore", "canon", "cringe", "based", "ratio", "stan",
    "simp", "touch grass", "chronically online", "unhinged", "feral", "goblin mode", "delulu",
    "rizz", "aura", "edgy", "softcore", "hardcore"
  ],
  "Fantasy Realms": [
    "dragon", "unicorn", "phoenix", "griffin", "basilisk", "chimera", "hydra", "pegasus", "centaur",
    "mermaid", "fairy", "elf", "dwarf", "goblin", "troll", "ogre", "orc", "wizard", "sorcerer",
    "witch", "warlock", "necromancer", "paladin", "ranger", "rogue", "bard", "druid", "monk",
    "wand", "staff", "amulet", "sword", "shield", "armor", "potion", "spell", "quest", "prophecy",
    "crystal", "dungeon", "castle"
  ],
  "Street Food": [
    "tacos", "churros", "empanadas", "samosas", "gyros", "shawarma", "kebabs", "takoyaki",
    "okonomiyaki", "elote", "arepas", "pupusas", "pho", "dumplings", "poutine", "roti",
    "crepes", "beignets", "falafel", "quesadilla", "burritos", "nachos", "pretzel", "corndog",
    "funnel cake", "waffle", "cronut", "donut", "bagel", "mochi", "bao", "tamale",
    "chimichanga", "tostada", "flautas", "gordita", "sope", "esquite", "chicharron", "churro", "bunuelo"
  ],
  "Retro Gaming": [
    "powerup", "checkpoint", "respawn", "fatality", "combo", "joystick", "controller",
    "cartridge", "pixel", "sprite", "noob", "pwned", "camping", "griefing", "loot",
    "boss", "health bar", "mana", "continue", "game over", "insert coin", "arcade",
    "highscore", "cheatcode", "speedrun", "glitch", "mod", "emulator", "ROM", "console",
    "platform", "sidescroller", "dungeon", "quest", "inventory", "save", "load", "pause", "warp", "secret", "bonus"
  ],
  "Space Odyssey": [
    "nebula", "quasar", "pulsar", "supernova", "wormhole", "asteroid", "comet", "meteor",
    "satellite", "starship", "rocket", "galaxy", "cosmos", "void", "orbit", "launch",
    "spacewalk", "alien", "exoplanet", "eclipse", "constellation", "antimatter", "hyperspace",
    "cryosleep", "terraforming", "moonbase", "colony", "spacecraft", "shuttle", "probe",
    "aurora", "solar", "lunar", "stellar", "cosmic", "astral", "celestial", "interstellar", "zero gravity", "stardust", "blackhole"
  ],
  "Urban Legends": [
    "Bigfoot", "Mothman", "Chupacabra", "Slenderman", "wendigo", "banshee", "poltergeist",
    "skinwalker", "cryptid", "phantom", "specter", "apparition", "haunting", "possession",
    "curse", "hex", "omen", "ritual", "s√©ance", "ouija", "cemetery", "graveyard",
    "tombstone", "crypt", "mausoleum", "coffin", "ghost", "spirit", "shadow", "entity",
    "demon", "vampire", "werewolf", "zombie", "ghoul", "monster", "creature", "beast", "legend", "myth", "folklore"
  ],
  "Coffee Culture": [
    "espresso", "cappuccino", "latte", "macchiato", "americano", "mocha", "frappe",
    "cortado", "affogato", "ristretto", "barista", "brew", "roast", "beans", "grind",
    "steam", "foam", "crema", "drip", "pour", "French press", "AeroPress", "siphon",
    "Turkish", "Vietnamese", "Irish", "iced", "cold brew", "nitro", "oat milk", "almond milk",
    "soy milk", "vanilla", "caramel", "hazelnut", "cinnamon", "chocolate", "whipped cream", "sprinkles", "syrup", "sugar"
  ],
  "Extreme Sports": [
    "parkour", "skydiving", "snowboarding", "skateboarding", "surfing", "wakeboarding",
    "BMX", "motocross", "kayaking", "rafting", "climbing", "bungee", "wingsuit",
    "paragliding", "kitesurfing", "slacklining", "highlining", "drifting", "rally",
    "downhill", "freeride", "halfpipe", "ramp", "grind", "ollie", "kickflip", "backflip",
    "frontflip", "aerial", "trick", "stunt", "jump", "drop", "carve", "shred", "gnarly",
    "radical", "tube", "barrel", "wave", "powder"
  ],
  "Mystical Artifacts": [
    "crystal", "tarot", "runes", "pendulum", "dreamcatcher", "cauldron", "grimoire",
    "athame", "chalice", "pentacle", "wand", "orb", "amulet", "talisman", "charm",
    "scroll", "tome", "spell", "potion", "elixir", "incense", "sage", "smudge",
    "candle", "altar", "offering", "ritual", "divination", "scrying", "mirror",
    "geode", "quartz", "amethyst", "obsidian", "moonstone", "selenite", "jade", "turquoise", "opal", "ruby"
  ],
  "Dystopian Future": [
    "cyberpunk", "neon", "hologram", "implant", "cyborg", "android", "robot", "drone",
    "AI", "algorithm", "surveillance", "corporation", "wasteland", "bunker", "vault",
    "radiation", "mutant", "clone", "synthetic", "virtual", "matrix", "grid", "network",
    "firewall", "hack", "virus", "malware", "glitch", "crash", "reboot", "upgrade",
    "augment", "biometric", "scanner", "chip", "code", "data", "upload", "download", "server"
  ],
  "Comfort Things": [
    "blanket", "pillow", "hoodie", "slippers", "robe", "candle", "tea", "coffee",
    "chocolate", "cookies", "soup", "fireplace", "hammock", "swing", "nap", "cuddle",
    "snuggle", "cozy", "warm", "soft", "fuzzy", "plush", "teddy", "book", "movie",
    "music", "rain", "snow", "autumn", "sweater", "scarf", "mittens", "socks", "pajamas",
    "bath", "bubble", "aromatherapy", "lavender", "vanilla", "cinnamon", "nostalgia"
  ],
  "Ocean Mysteries": [
    "kraken", "megalodon", "leviathan", "serpent", "mermaid", "siren", "shipwreck",
    "treasure", "atlantis", "abyss", "trench", "reef", "kelp", "jellyfish", "squid",
    "octopus", "anglerfish", "shark", "whale", "dolphin", "narwhal", "seahorse", "starfish",
    "coral", "pearl", "shell", "tsunami", "whirlpool", "maelstrom", "tide", "current",
    "wave", "depth", "submarine", "anchor", "lighthouse", "buoy", "sailor", "pirate", "mariner"
  ],
  "Cozy Aesthetics": [
    "cottagecore", "grandmacore", "bookshelf", "teacup", "vintage", "antique", "rustic",
    "farmhouse", "cottage", "cabin", "hearth", "quilt", "knitting", "crochet", "embroidery",
    "lace", "floral", "botanical", "garden", "greenhouse", "windowsill", "plants", "herbs",
    "wildflower", "daisy", "rose", "lavender", "honeysuckle", "mushroom", "moss", "fern",
    "basket", "wicker", "pottery", "ceramic", "handmade", "homemade", "baking", "bread", "jam", "honey"
  ]
}

export const ALL_CATEGORIES = Object.keys(WORD_BANK)

// Seeded RNG helpers
function cyrb128(str: string): number[] {
  let h1 = 1779033703, h2 = 3144134277, h3 = 1013904242, h4 = 2773480762
  for (let i = 0, k; i < str.length; i++) {
    k = str.charCodeAt(i)
    h1 = h2 ^ Math.imul(h1 ^ k, 597399067)
    h2 = h3 ^ Math.imul(h2 ^ k, 2869860233)
    h3 = h4 ^ Math.imul(h3 ^ k, 951274213)
    h4 = h1 ^ Math.imul(h4 ^ k, 2716044179)
  }
  h1 = Math.imul(h3 ^ (h1 >>> 18), 597399067)
  h2 = Math.imul(h4 ^ (h2 >>> 22), 2869860233)
  h3 = Math.imul(h1 ^ (h3 >>> 17), 951274213)
  h4 = Math.imul(h2 ^ (h4 >>> 19), 2716044179)
  return [(h1 ^ h2 ^ h3 ^ h4) >>> 0]
}

function mulberry32(a: number) {
  return function() {
    let t = (a += 0x6D2B79F5)
    t = Math.imul(t ^ (t >>> 15), t | 1)
    t ^= t + Math.imul(t ^ (t >>> 7), t | 61)
    return ((t ^ (t >>> 14)) >>> 0) / 4294967296
  }
}

export function seededRandFromKey(key: string) {
  const [seed] = cyrb128(key)
  return mulberry32(seed)
}

export function numberFromRng(rng: () => number, max: number): number {
  return Math.floor(rng() * max) % max
}

export function pickDeterministic<T>(rng: () => number, arr: T[]): T {
  return arr[Math.floor(rng() * arr.length) % arr.length]
}

export interface GameState {
  players: number
  round: number
  category: string
  activePlayer: number | null
  revealed: boolean
  impostorIndex: number
  chosenWord: string
  startPlayerIndex: number
  gameStarted: boolean
}

export function createGameState(players: number, round: number, category: string): GameState {
  const roomKey = `${round}#${players}#${category}`
  const words = WORD_BANK[category]
  
  const impostorIndex = numberFromRng(seededRandFromKey(roomKey + ':imp'), players)
  const chosenWord = pickDeterministic(seededRandFromKey(roomKey + ':word'), words)
  const startPlayerIndex = numberFromRng(seededRandFromKey(roomKey + ':start'), players)
  
  return {
    players,
    round,
    category,
    activePlayer: null,
    revealed: false,
    impostorIndex,
    chosenWord,
    startPlayerIndex,
    gameStarted: false
  }
}